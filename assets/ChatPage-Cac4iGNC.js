import{i as $,j as g,d as S,k as E,l as D,o as m,g as y,n as t,a as o,t as _,m as q,u as P,p as z,c as b,w as C,b as r,e as w,q as I,h as R,F as U,s as N,v as V,f as M,x as L}from"./index-CiVBJYKN.js";import{_ as A,P as O,B as x}from"./PageLayout-CDmakjhY.js";import{B as T}from"./BaseButton-MFkTaFwz.js";const W="/api/v1/chat",F={async sendMessage(i,e,l){try{const s=await fetch(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:i}),signal:l});if(!s.ok)throw new Error(`Chat API error: ${s.status} ${s.statusText}`);const c=s.body;if(!c)throw new Error("Response body is null");const n=c.getReader(),p=new TextDecoder;for(;;){const{done:d,value:u}=await n.read();if(d){e.onDone();break}const h=p.decode(u,{stream:!0});e.onChunk(h)}}catch(s){if(s instanceof DOMException&&s.name==="AbortError"){e.onDone();return}e.onError(s instanceof Error?s:new Error(String(s)))}}};function K(){const i=g([]),e=g(!1),l=g(null);let s=null;function c(u){i.value.push({role:"system",content:u,timestamp:Date.now()})}async function n(u){if(!u.trim()||e.value)return;l.value=null;const h={role:"user",content:u.trim(),timestamp:Date.now()};i.value.push(h);const k={role:"assistant",content:"",timestamp:Date.now()};i.value.push(k),e.value=!0,s=new AbortController;const a=i.value.length-1;await F.sendMessage(i.value.slice(0,-1),{onChunk(v){i.value[a].content+=v},onDone(){e.value=!1,s=null},onError(v){e.value=!1,l.value=v.message,s=null}},s.signal)}function p(){s&&(s.abort(),s=null,e.value=!1)}function d(){i.value=[],l.value=null}return{messages:$(i),isStreaming:$(e),error:$(l),sendMessage:n,stopStreaming:p,clearMessages:d,addSystemMessage:c}}const j=S({__name:"ThinkingIndicator",setup(i){const e=g(0);let l=null;const s=g(""),c=["analyzing","processing","generating"];return E(()=>{let n=0;s.value=c[0],l=window.setInterval(()=>{e.value<100?(e.value+=Math.random()*5,e.value>100&&(e.value=100)):e.value=0,e.value>30&&n===0?(n=1,s.value=c[1]):e.value>70&&n===1&&(n=2,s.value=c[2])},100)}),D(()=>{l&&clearInterval(l)}),(n,p)=>(m(),y("div",{class:t(n.$style.thinkingIndicator)},[o("div",{class:t(n.$style.header)},[o("span",{class:t(n.$style.icon)},"âš¡",2),o("span",{class:t(n.$style.text)},"EMCODER_AI "+_(e.value.toFixed(0))+"%",3)],2),o("div",{class:t(n.$style.track)},[o("div",{class:t(n.$style.bar),style:q({width:`${e.value}%`})},null,6)],2),o("div",{class:t(n.$style.status)},[o("span",{class:t(n.$style.statusText)},"> "+_(s.value)+"...",3),o("span",{class:t(n.$style.cursor)},"_",2)],2)],2))}}),H="_thinkingIndicator_1hqe7_1",J="_slideUp_1hqe7_1",Y="_header_1hqe7_26",G="_track_1hqe7_35",Q="_bar_1hqe7_43",X="_stripeMove_1hqe7_1",Z="_status_1hqe7_61",ee="_cursor_1hqe7_67",se="_blink_1hqe7_1",ae={thinkingIndicator:H,slideUp:J,header:Y,track:G,bar:Q,stripeMove:X,status:Z,cursor:ee,blink:se},te={$style:ae},ne=A(j,[["__cssModules",te]]),oe=["placeholder","disabled","aria-label"],le=S({__name:"ChatPage",setup(i){const{t:e}=P(),{messages:l,isStreaming:s,error:c,sendMessage:n,stopStreaming:p}=K(),d=g(""),u=g(null);async function h(){const a=d.value.trim();!a||s.value||(d.value="",await n(a))}function k(a){a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),h())}return z(()=>l.value.length>0?l.value[l.value.length-1].content:"",async()=>{await L(),u.value&&(u.value.scrollTop=u.value.scrollHeight)}),(a,v)=>(m(),b(O,null,{default:C(()=>[o("div",{class:t(a.$style.chatPage)},[o("div",{ref_key:"chatContainer",ref:u,class:t(a.$style.messages)},[r(l).length===0?(m(),y("div",{key:0,class:t(a.$style.welcome)},[o("div",{class:t(a.$style.welcomeIcon)},[w(x,{name:"message-square",size:32})],2),o("p",{class:t(a.$style.welcomeText)},_(r(e)("chat.welcome")),3)],2)):I("",!0),(m(!0),y(U,null,R(r(l),(f,B)=>(m(),y("div",{key:B,class:t([a.$style.message,a.$style[`message--${f.role}`]])},[o("div",{class:t(a.$style.messageBubble)},[o("div",{class:t(a.$style.messageRole)},_(f.role==="user"?"You":"EmcoderCLI"),3),o("div",{class:t(a.$style.messageContent)},_(f.content),3)],2)],2))),128)),r(s)?(m(),y("div",{key:1,class:t(a.$style.thinking),role:"status","aria-live":"polite"},[w(ne)],2)):I("",!0),r(c)?(m(),y("div",{key:2,class:t(a.$style.error),role:"alert"},_(r(c)),3)):I("",!0)],2),o("p",{class:t(a.$style.disclaimer)},_(r(e)("chat.disclaimer")),3),o("div",{class:t(a.$style.inputArea)},[o("div",{class:t(a.$style.inputWrap)},[N(o("textarea",{"onUpdate:modelValue":v[0]||(v[0]=f=>d.value=f),class:t(a.$style.input),placeholder:r(e)("chat.placeholder"),disabled:r(s),rows:"1","aria-label":r(e)("chat.placeholder"),onKeydown:k},null,42,oe),[[V,d.value]]),r(s)?(m(),b(T,{key:0,variant:"ghost",size:"sm",onClick:r(p)},{default:C(()=>[w(x,{name:"x",size:16}),M(" "+_(r(e)("actions.cancel")),1)]),_:1},8,["onClick"])):(m(),b(T,{key:1,variant:"primary",size:"sm",disabled:!d.value.trim(),onClick:h},{default:C(()=>[w(x,{name:"send",size:16}),M(" "+_(r(e)("actions.send")),1)]),_:1},8,["disabled"]))],2)],2)],2)]),_:1}))}}),re="_chatPage_9s4x7_2",ie="_messages_9s4x7_11",ce="_welcome_9s4x7_20",ue="_welcomeIcon_9s4x7_30",de="_welcomeText_9s4x7_41",me="_message_9s4x7_11",_e="_message--user_9s4x7_52",ge="_message--assistant_9s4x7_56",pe="_message--system_9s4x7_57",he="_messageBubble_9s4x7_62",ve="_popIn_9s4x7_1",ye="_messageRole_9s4x7_94",fe="_messageContent_9s4x7_104",we="_thinking_9s4x7_111",ke="_error_9s4x7_120",$e="_disclaimer_9s4x7_127",be="_inputArea_9s4x7_135",Ce="_inputWrap_9s4x7_140",Ie="_input_9s4x7_135",xe={chatPage:re,messages:ie,welcome:ce,welcomeIcon:ue,welcomeText:de,message:me,messageUser:_e,messageAssistant:ge,messageSystem:pe,messageBubble:he,popIn:ve,messageRole:ye,messageContent:fe,thinking:we,error:ke,disclaimer:$e,inputArea:be,inputWrap:Ce,input:Ie},Me={$style:xe},Be=A(le,[["__cssModules",Me]]);export{Be as default};
